{"version":3,"sources":["../src/index.ts","../src/auth/setUserRole.ts"],"sourcesContent":["import * as admin from 'firebase-admin';\nimport { setUserRole } from './auth/setUserRole';\n\nadmin.initializeApp();\n\nexport { setUserRole }; ","import * as functions from 'firebase-functions';\nimport * as admin from 'firebase-admin';\nimport { UserRole } from '../types/auth';\n\nconst validRoles: UserRole[] = ['user', 'manager', 'admin'];\n\nexport const setUserRole = functions.https.onCall(async (data, context) => {\n  // Type check the input\n  if (!context.auth?.token.admin) {\n    throw new functions.https.HttpsError(\n      'permission-denied',\n      'Only admins can set roles'\n    );\n  }\n\n  const { uid, role } = data;\n  \n  // Validate input\n  if (!uid || !validRoles.includes(role as UserRole)) {\n    throw new functions.https.HttpsError(\n      'invalid-argument',\n      'Invalid user ID or role'\n    );\n  }\n\n  try {\n    // Update custom claims\n    await admin.auth().setCustomUserClaims(uid, { role });\n    \n    // Update user document\n    await admin.firestore().doc(`users/${uid}`).update({ role });\n\n    return { success: true };\n  } catch (error) {\n    console.error('Error setting user role:', error);\n    throw new functions.https.HttpsError(\n      'internal',\n      'Error setting user role'\n    );\n  }\n}); "],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAAA,SAAuB;;;ACAvB,gBAA2B;AAC3B,YAAuB;AAGvB,IAAM,aAAyB,CAAC,QAAQ,WAAW,OAAO;AAEnD,IAAM,cAAwB,gBAAM,OAAO,OAAO,MAAM,YAAY;AAN3E;AAQE,MAAI,GAAC,aAAQ,SAAR,mBAAc,MAAM,QAAO;AAC9B,UAAM,IAAc,gBAAM;AAAA,MACxB;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAEA,QAAM,EAAE,KAAK,KAAK,IAAI;AAGtB,MAAI,CAAC,OAAO,CAAC,WAAW,SAAS,IAAgB,GAAG;AAClD,UAAM,IAAc,gBAAM;AAAA,MACxB;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAEA,MAAI;AAEF,UAAY,WAAK,EAAE,oBAAoB,KAAK,EAAE,KAAK,CAAC;AAGpD,UAAY,gBAAU,EAAE,IAAI,SAAS,GAAG,EAAE,EAAE,OAAO,EAAE,KAAK,CAAC;AAE3D,WAAO,EAAE,SAAS,KAAK;AAAA,EACzB,SAAS,OAAO;AACd,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,UAAM,IAAc,gBAAM;AAAA,MACxB;AAAA,MACA;AAAA,IACF;AAAA,EACF;AACF,CAAC;;;ADrCK,qBAAc;","names":["admin"]}